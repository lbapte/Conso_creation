import React, { useEffect } from 'react';
import { Svg, Path } from 'react-native-svg';
import Animated, {
  useSharedValue,
  useAnimatedProps,
  withRepeat,
  withTiming,
  Easing,
} from 'react-native-reanimated';

const AnimatedPath = Animated.createAnimatedComponent(Path);

// Durée d’un cycle complet en ms
const CYCLE = 1200;
// Proportion du cycle pour le fade-out rapide
const FAST_RATIO = 0.5;

export default function Logo({
  width = 200,
  height = 200,
}: {
  width?: number;
  height?: number;
}) {
  // progress va de 0→1 en CYCLE ms, en boucle
  const progress = useSharedValue(0);
  useEffect(() => {
    progress.value = withRepeat(
      withTiming(1, {
        duration: CYCLE,
        easing: Easing.linear,
      }),
      -1,
      false
    );
  }, []);

  // Génère les props animées pour le i-ème crochet
  const makeProps = (i: number) =>
    useAnimatedProps(() => {
      // temps absolu dans le cycle [0, CYCLE)
      const tAbs = (progress.value * CYCLE + CYCLE - (i * CYCLE) / 4) % CYCLE;
      const t = tAbs / CYCLE; // normalisé 0→1

      let opacity: number;
      if (t < FAST_RATIO) {
        // fade-out rapide
        const local = t / FAST_RATIO; 
        const eased = Easing.out(Easing.cubic)(local);
        opacity = 1 - eased;
      } else {
        // fade-in lent
        const local = (t - FAST_RATIO) / (1 - FAST_RATIO);
        const eased = Easing.in(Easing.cubic)(local);
        opacity = eased;
      }

      return { fillOpacity: opacity };
    });

  return (
    <Svg width={width} height={height} viewBox="0 0 806 165" fill="none">
      <AnimatedPath
        animatedProps={makeProps(0)}
        d="M109.129 13.0583L109.149 37.0768L134.88 37.0553L134.902 62.9213L158.514 62.9016L158.483 25.0263C158.477 18.1503 153.134 13.0216 146.061 13.0275L109.129 13.0583Z"
        fill="#98FFBF"
      />
      <AnimatedPath
        animatedProps={makeProps(1)}
        d="M158.546 101.122L134.316 101.142L134.338 127.673L108.243 127.695L108.263 152.041L146.473 152.009C153.41 152.003 158.584 146.494 158.578 139.201L158.546 101.122Z"
        fill="white"
      />
      <AnimatedPath
        animatedProps={makeProps(2)}
        d="M71.4417 152.071L71.4212 127.575L45.1779 127.597L45.1558 101.216L21.0737 101.236L21.106 139.865C21.1118 146.878 26.5613 152.109 33.7748 152.103L71.4417 152.071Z"
        fill="white"
      />
      <AnimatedPath
        animatedProps={makeProps(3)}
        d="M21.0416 62.9321L44.7595 62.9123L44.7378 36.9428L70.2801 36.9215L70.2602 13.0907L32.8589 13.1219C26.069 13.1276 21.0045 18.5201 21.0105 25.6583L21.0416 62.9321Z"
        fill="white"
      />
      {/* le reste du logo (statique) */}
      <Path
        d="M210.78 152V11.1352H234.622V72.3808H302.43V11.1352H326.272V152H302.43V90.7544H234.622V152H210.78ZM403.55 154.187C384.885 154.187 371.177 149.521 362.428 140.188C353.824 130.856 349.523 117.513 349.523 100.16C349.523 82.8071 353.897 69.4643 362.647 60.1317C371.396 50.799 385.03 46.1327 403.55 46.1327C422.215 46.1327 435.923 50.799 444.672 60.1317C453.421 69.4643 457.796 82.8071 457.796 100.16C457.796 117.513 453.421 130.856 444.672 140.188C436.068 149.521 422.361 154.187 403.55 154.187ZM403.55 134.064C414.487 134.064 422.215 131.439 426.736 126.189C431.402 120.794 433.735 112.117 433.735 100.16C433.735 88.2025 431.402 79.599 426.736 74.3494C422.215 69.0998 414.487 66.4749 403.55 66.4749C392.759 66.4749 385.03 69.0998 380.364 74.3494C375.844 79.599 373.583 88.2025 373.583 100.16C373.583 112.117 375.844 120.794 380.364 126.189C385.03 131.439 392.759 134.064 403.55 134.064ZM530.646 154.187C511.981 154.187 498.274 149.521 489.524 140.188C480.921 130.856 476.619 117.513 476.619 100.16C476.619 82.8071 480.994 69.4643 489.743 60.1317C498.493 50.799 512.127 46.1327 530.646 46.1327C549.312 46.1327 563.019 50.799 571.768 60.1317C580.518 69.4643 584.893 82.8071 584.893 100.16C584.893 117.513 580.518 130.856 571.768 140.188C563.165 149.521 549.458 154.187 530.646 154.187ZM530.646 134.064C541.583 134.064 549.312 131.439 553.832 126.189C558.499 120.794 560.832 112.117 560.832 100.16C560.832 88.2025 558.499 79.599 553.832 74.3494C549.312 69.0998 541.583 66.4749 530.646 66.4749C519.856 66.4749 512.127 69.0998 507.461 74.3494C502.94 79.599 500.68 88.2025 500.68 100.16C500.68 112.117 502.94 120.794 507.461 126.189C512.127 131.439 519.856 134.064 530.646 134.064ZM608.09 152V4.57318H631.932V89.8795L675.46 48.32H702.802L660.587 90.0982L705.208 152H680.054L645.713 102.785L631.932 115.909V152H608.09ZM752.445 154.187C745.299 154.187 738.446 153.677 731.884 152.656C725.467 151.635 720.145 150.396 715.916 148.938V128.814C720.874 130.71 726.342 132.168 732.321 133.189C738.3 134.21 743.987 134.72 749.382 134.72C757.548 134.72 763.381 133.991 766.881 132.533C770.381 131.074 772.131 128.231 772.131 124.002C772.131 120.94 771.037 118.534 768.85 116.784C766.808 115.034 763.673 113.43 759.444 111.972C755.361 110.513 750.111 108.764 743.695 106.722C737.571 104.681 732.248 102.493 727.728 100.16C723.207 97.681 719.707 94.5458 717.228 90.7544C714.749 86.963 713.51 82.0051 713.51 75.8805C713.51 66.402 716.937 59.1109 723.79 54.0071C730.644 48.7575 741.654 46.1327 756.819 46.1327C762.798 46.1327 768.485 46.5701 773.881 47.4451C779.276 48.32 783.869 49.4137 787.661 50.7261V70.6309C783.578 69.0268 779.057 67.7873 774.099 66.9124C769.287 66.0375 764.767 65.6 760.538 65.6C752.955 65.6 747.195 66.2562 743.258 67.5686C739.466 68.881 737.571 71.5058 737.571 75.443C737.571 79.5261 739.539 82.4425 743.477 84.1924C747.56 85.7965 754.049 88.0567 762.944 90.9732C771.11 93.4522 777.599 96.077 782.411 98.8476C787.223 101.618 790.65 104.972 792.692 108.909C794.879 112.701 795.973 117.659 795.973 123.783C795.973 133.991 792.254 141.647 784.817 146.75C777.38 151.708 766.589 154.187 752.445 154.187Z"
        fill="white"
      />
    </Svg>
  );
}
